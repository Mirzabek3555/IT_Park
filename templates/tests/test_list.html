{% extends 'base.html' %}

{% block title %}Testlar - Tuproqqal'a IT Park{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section bg-primary text-white py-5">
    <div class="container">
        <div class="text-center">
            <h1 class="display-4 fw-bold mb-4">
                <i class="fas fa-question-circle me-3"></i>
                Testlar
            </h1>
            <p class="lead">
                IT sohasining turli yo'nalishlarida bilim va ko'nikmalaringizni sinab ko'ring. 
                Dasturlash, matematika, informatika va fizika fanlaridan testlar mavjud.
            </p>
        </div>
    </div>
</section>

<!-- Search and Filters -->
<section class="py-4 bg-light">
    <div class="container">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="input-group">
                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                    <input type="text" class="form-control" id="test-search" placeholder="Test qidirish...">
                </div>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="category-filter">
                    <option value="">Barcha kategoriyalar</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select" id="subject-filter">
                    <option value="">Barcha fanlar</option>
                    <option value="programming">Dasturlash</option>
                    <option value="mathematics">Matematika</option>
                    <option value="informatics">Informatika</option>
                    <option value="physics">Fizika</option>
                </select>
            </div>
        </div>
    </div>
</section>

<!-- Tests Grid -->
<section class="py-5">
    <div class="container">
        {% if tests %}
            <div class="row g-4">
                {% for test in tests %}
                <div class="col-md-6 col-lg-4 test-card" data-category="{{ test.category.id }}" data-subject="{{ test.subject }}">
                    <div class="card h-100 shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-light text-primary">{{ test.get_subject_display }}</span>
                                <span class="badge bg-warning text-dark">{{ test.time_limit }} daq</span>
                            </div>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title test-title">{{ test.title }}</h5>
                            <p class="card-text test-description flex-grow-1">{{ test.description|truncatewords:15 }}</p>
                            <div class="mb-3">
                                <small class="text-muted">
                                    <i class="fas fa-layer-group me-1"></i>
                                    <span class="test-category">{{ test.category.name }}</span>
                                </small>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-success">{{ test.max_score }} ball</span>
                                <span class="badge bg-info">{{ test.questions.count }} savol</span>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent">
                            <a href="{% url 'tests:test_detail' test.id %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-play me-2"></i>Testni boshlash
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-5">
                <i class="fas fa-question-circle fa-5x text-muted mb-4"></i>
                <h3 class="text-muted">Hozircha testlar mavjud emas</h3>
                <p class="lead text-muted">
                    Tez orada yangi testlar qo'shiladi. 
                    <a href="{% url 'main:home' %}" class="text-decoration-none">Bosh sahifaga qaytish</a>
                </p>
            </div>
        {% endif %}
    </div>
</section>

<!-- Call to Action -->
<section class="py-5 bg-light">
    <div class="container text-center">
        <h2 class="display-5 fw-bold mb-4">Testlashni boshlang!</h2>
        <p class="lead mb-4">
            Testlar orqali o'z bilim va ko'nikmalaringizni oshiring. 
            Reytingda yuqori o'rinlarni egallang va o'z darajangizni aniqlang.
        </p>
        <div class="d-flex justify-content-center gap-3">
            <a href="{% url 'tests:leaderboard' %}" class="btn btn-primary btn-lg">
                <i class="fas fa-trophy me-2"></i>Reytingni ko'rish
            </a>
            <a href="{% url 'main:directions_list' %}" class="btn btn-outline-primary btn-lg">
                <i class="fas fa-directions me-2"></i>Yo'nalishlar
            </a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Search functionality
    document.getElementById('test-search').addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const testCards = document.querySelectorAll('.test-card');
        
        testCards.forEach(card => {
            const title = card.querySelector('.test-title').textContent.toLowerCase();
            const description = card.querySelector('.test-description').textContent.toLowerCase();
            const category = card.querySelector('.test-category').textContent.toLowerCase();
            
            if (title.includes(searchTerm) || description.includes(searchTerm) || category.includes(searchTerm)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    });

    // Filter functionality
    function applyFilters() {
        const categoryFilter = document.getElementById('category-filter').value;
        const subjectFilter = document.getElementById('subject-filter').value;
        const testCards = document.querySelectorAll('.test-card');
        
        testCards.forEach(card => {
            const cardCategory = card.dataset.category;
            const cardSubject = card.dataset.subject;
            
            const categoryMatch = !categoryFilter || cardCategory === categoryFilter;
            const subjectMatch = !subjectFilter || cardSubject === subjectFilter;
            
            if (categoryMatch && subjectMatch) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }

    document.getElementById('category-filter').addEventListener('change', applyFilters);
    document.getElementById('subject-filter').addEventListener('change', applyFilters);
</script>
{% endblock %}
